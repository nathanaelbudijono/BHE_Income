@{
    Layout = "_EmptyLayout";
}



<main class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-neutral-accent-100 p-8">
            <img src="~/images/logo-binus.png" class="w-32" />
            <div class="text-start mb-5">
                <Typography variant="h3" font="bold" class="mb-2" color="dark">Welcome Back</Typography>
                <Typography variant="p">Sign in to your account to continue your journey</Typography>
            </div>
            <form class="space-y-5 max-lg:space-y-3" onsubmit="handleLogin(event)">
                <div class="space-y-2">
                    <Typography variant="p" font="semibold">Email Address</Typography>
                    @(Html.DevExtreme().TextBox()
                                        .Placeholder("Enter your email address")
                                        .ID("Email")
                                        .InputAttr("required", "required")
                                        .InputAttr("type", "email")
                                        .ValidationRules(rules => {
                                            rules.AddRequired()
                                                .Message("Email field is required.");
                                            rules.AddEmail()
                                                .Message("Must be type of email");
                                        })
                                        .Buttons(b =>
                                        {
                                            b.Add()
                                            .Name("atIcon")
                                            .Location(TextEditorButtonLocation.Before)
                                            .Widget(w => w.Button()
                                            .Icon("email")
                                            .StylingMode(ButtonStylingMode.Text)
                                            .Disabled(true)
                                            );
                                        }))
                </div>
                <div class="space-y-2">
                    <Typography variant="p" font="semibold">Password</Typography>
                    @(
                                        Html.DevExtreme().TextBox()
                                        .Placeholder("Enter your password")
                                        .ID("Password")
                                        .Mode(TextBoxMode.Password)
                                        .InputAttr("required", "required")
                                        .InputAttr("aria-label", "Password")
                                         .ValidationRules(rules => {
                                            rules.AddRequired()
                                                .Message("Password field is required.");
                                        })
                                        .Buttons(b =>
                                        {
                                            b.Add()
                                            .Name("lockIcon")
                                            .Location(TextEditorButtonLocation.Before)
                                            .Widget(w => w.Button()
                                            .Icon("lock")
                                            .StylingMode(ButtonStylingMode.Text)
                                            .Disabled(true)
                                            );

                                            b.Add()
                                            .Name("passwordToggle")
                                            .Location(TextEditorButtonLocation.After)
                                            .Widget(w => w.Button()
                                            .Icon("eyeopen")
                                            .StylingMode(ButtonStylingMode.Text)
                                            .OnClick("togglePasswordVisibility")
                                            );
                                        })
                                        )
                </div>

                <div class="flex justify-end">
                    <Typography font="medium"  variant="sm">
                        <a href="#" class="hover:text-neutral-300 transition-colors">
                            Forgot your password?
                        </a>
                    </Typography>

                </div>

                <button type="submit"
                        class="w-full bg-primary-100 hover:bg-primary-200 text-white font-semibold py-2 px-3 rounded-xl transition-all duration-200 transform hover:scale-[1.02] focus:ring-4 focus:ring-primary/20 focus:outline-none ">
                    <Typography font="semibold" class="text-white">Sign in</Typography>
                </button>

                <div class="relative my-3 2xl:my-5">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-200"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <Typography font="light" variant="sm" class="bg-white px-2">Or Continue with</Typography>
                    </div>
                </div>

                <button type="button"
                        class="w-full flex items-center justify-center gap-3 bg-white border border-gray-200 hover:border-gray-300 text-gray-700 font-medium py-3 px-4 rounded-xl transition-all duration-200 hover:shadow-md focus:ring-4 focus:ring-gray-100 focus:outline-none">
                    <svg class="w-5 h-5" viewBox="0 0 23 23" fill="none">
                        <path d="M1 1h10v10H1z" fill="#f25022" />
                        <path d="M12 1h10v10H12z" fill="#00a4ef" />
                        <path d="M1 12h10v10H1z" fill="#ffb900" />
                        <path d="M12 12h10v10H12z" fill="#7fba00" />
                    </svg>
                    <Typography font="semibold">Continue with Microsoft</Typography>
                </button>
            </form>

        </div>
    </div>
</main>

@section scripts{
<script>
    const handleLogin = async (e) => {
        e.preventDefault(); 
        const result = DevExpress.validationEngine.validateGroup();
        if(!result.isValid){
            return;
        }

        const payload = {
            email: getDxTextBox("Email").value,
            password: getDxTextBox("Password").value
        }

       const res = await postFetcher(`${API_URL}/authentication/login`,payload);

       if(res.status === "error"){
        handleException(res.message, res.status);
        return;
       }

       localStorage.setItem("stamp-token", res.data.token);
       document.cookie = `stamp-token=${res.data.token}; path=/; Secure; SameSite=Lax`;
       window.location.href = `${BASE_URL}/home/index`;
       
      
    };

</script>
}
